stages:
  - build
  - codestyle
  - test

# BUILD STAGES
build_cat:
  stage: build
  script:
    - cd src/C2_SimpleBashUtils/cat
    - make
  artifacts:
    paths:
      - src/artifacts/*
    expire_in: 30 days

build_grep:
  stage: build
  script:
    - cd src/C2_SimpleBashUtils/grep
    - make
  artifacts:
    paths:
      - src/artifacts/*
    expire_in: 30 days

# CODESTYLE STAGE
codestyle:
  stage: codestyle
  script:
    - cd src/C2_SimpleBashUtils
    - shopt -s globstar && clang-format -n --style=Google src/**/*.{c,h}
  allow_failure: false

# TEST STAGES
test_cat:
  stage: test
  script:
    - bash src/C2_SimpleBashUtils/cat/tests.sh
  dependencies:
    - codestyle
  allow_failure: false

test_grep:
  stage: test
  script:
    - bash src/C2_SimpleBashUtils/grep/tests.sh
  dependencies:
    - codestyle
  allow_failure: false
